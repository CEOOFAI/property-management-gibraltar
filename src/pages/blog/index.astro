---
import BaseLayout from '../../layouts/BaseLayout.astro';
import SEOHead from '../../components/SEOHead.astro';
import { supabase, SITE } from '../../lib/supabase';
import { generateBreadcrumbLD } from '../../lib/seo';
const { data: posts } = await supabase.from('blog_posts').select('*').eq('site', SITE).eq('is_published', true).order('published_at', { ascending: false });
const breadcrumbs = generateBreadcrumbLD([{ name: 'Home', url: 'https://propertymanagementgibraltar.com' }, { name: 'Blog', url: 'https://propertymanagementgibraltar.com/blog' }]);
function formatDate(d?: string) { if(!d)return''; return new Date(d).toLocaleDateString('en-GB',{day:'numeric',month:'short',year:'numeric'}); }
---
<BaseLayout>
  <SEOHead slot="head" title="Property Management Blog — Gibraltar Landlord Advice" description="Expert advice for Gibraltar landlords: rental yields, legal updates, maintenance tips, and market insights." structuredData={breadcrumbs} />
  <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <nav class="text-sm text-stone-500 mb-6"><a href="/" class="hover:text-emerald-700">Home</a><span class="mx-2">›</span><span class="text-stone-800">Blog</span></nav>
    <h1 class="text-3xl sm:text-4xl font-heading font-bold mb-10">Landlord <span class="gradient-text">Insights</span></h1>
    {(posts||[]).length > 0 ? (
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {(posts||[]).map((p: any) => (
          <a href={`/blog/${p.slug}`} class="card-interactive group overflow-hidden !p-0">
            {(p.cover_image||p.featured_image) && <div class="aspect-video bg-stone-100 overflow-hidden"><img src={p.cover_image||p.featured_image} alt={p.title} class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" loading="lazy"/></div>}
            <div class="p-5">
              {p.category && <span class="inline-flex items-center px-3 py-1 rounded-full bg-emerald-50 text-emerald-700 text-xs font-semibold mb-2">{p.category}</span>}
              <h3 class="font-heading font-bold text-lg text-stone-900 group-hover:text-emerald-700 transition-colors line-clamp-2">{p.title}</h3>
              {p.excerpt && <p class="text-stone-500 text-sm mt-1.5 line-clamp-2">{p.excerpt}</p>}
              <span class="text-stone-400 text-xs mt-3 block">{formatDate(p.published_at)}</span>
            </div>
          </a>
        ))}
      </div>
    ) : (
      <div class="card text-center py-16"><h3 class="font-heading font-bold text-xl mb-2">Articles Coming Soon</h3><p class="text-stone-500">Expert guides for Gibraltar landlords are on the way.</p></div>
    )}
  </section>
</BaseLayout>
